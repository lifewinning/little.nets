<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=US-ASCII">
<title>The Temple Operating System</title>
<meta name="keywords" content="Operating System,64-Bit,64 Bit,Temple,OS,TempleOS,Free,Open Source,Public Domain,x86_64">
<meta name="generator" content="TempleOS V2.13">
<style type="text/css">
.cF0{color:#000000;background-color:#fcfcfc;}
.cF1{color:#0000a8;background-color:#fcfcfc;}
.cF2{color:#00a800;background-color:#fcfcfc;}
.cF3{color:#00a8a8;background-color:#fcfcfc;}
.cF4{color:#a80000;background-color:#fcfcfc;}
.cF5{color:#a800a8;background-color:#fcfcfc;}
.cF6{color:#a85400;background-color:#fcfcfc;}
.cF7{color:#a8a8a8;background-color:#fcfcfc;}
.cF8{color:#545454;background-color:#fcfcfc;}
.cF9{color:#5454fc;background-color:#fcfcfc;}
.cFA{color:#54fc54;background-color:#fcfcfc;}
.cFB{color:#54fcfc;background-color:#fcfcfc;}
.cFC{color:#fc5454;background-color:#fcfcfc;}
.cFD{color:#fc54fc;background-color:#fcfcfc;}
.cFE{color:#fcfc54;background-color:#fcfcfc;}
.cFF{color:#fcfcfc;background-color:#fcfcfc;}
</style>
</head>
<body>
<pre style="font-family:courier;font-size:10pt">
<a name="l1"></a></blink><span class=cF5>                              Directory Structure</span><span class=cF0>
<a name="l2"></a>
<a name="l3"></a></span><span class=cF2>/Accts</span><span class=cF0> Each subdirectory is an acct.  When you boot, you can select an acct to 
<a name="l4"></a>login to, unless you compile Kernel soas to pick one.  Your acct directory is 
<a name="l5"></a>your </span><span class=cF2>HOME</span><span class=cF0> directory and all your user data should be placed in here to ease 
<a name="l6"></a>backing-up your data.  When you Install an application it will create a 
<a name="l7"></a>subdirectory of your </span><span class=cF2>HOME</span><span class=cF0> directory for storage.
<a name="l8"></a>
<a name="l9"></a></span><span class=cF2>/Apps</span><span class=cF0> Applications are placed in subdirectories of </span><span class=cF2>/Apps</span><span class=cF0>.  Applications should 
<a name="l10"></a>have a file called </span><span class=cF2>Install.CPP.Z</span><span class=cF0> which will install the app for the current user 
<a name="l11"></a>acct.  The file, </span><span class=cF2>Load.CPP.Z</span><span class=cF0> will load the application into mem.  The file, </span><span class=cF2>Run.C
<a name="l12"></a>PP.Z</span><span class=cF0>, will usually load and execute the app.  To add an app to your 
<a name="l13"></a>PersonalMenu, use </span><span class=cF2>&lt;CTRL-l&gt;</span><span class=cF0>, insert a macro with the PopUp option checked and 
<a name="l14"></a>invoke the </span><span class=cF2>Run.CPP.Z</span><span class=cF0> file.
<a name="l15"></a>
<a name="l16"></a></span><span class=cF2>/Demo</span><span class=cF0> Here you can find lots of sample code to do various things.
<a name="l17"></a>
<a name="l18"></a></span><span class=cF2>/Doc</span><span class=cF0> Here you can find documentation.
<a name="l19"></a>
<a name="l20"></a></span><span class=cF2>/Kernel</span><span class=cF0> The core of the operating system is found here.  Since priviledge levels 
<a name="l21"></a>are not used, calling it a </span><span class=cF2>kernel</span><span class=cF0> is deceptive.  It is </span><span class=cF2>AOT</span><span class=cF0> compiled by </span><span class=cF4>
<a name="l22"></a></span><a href="../Adam/Boot/InsBoot.html#l135"></blink><span class=cF4>MakeOSPrtBootInstall</span></a></blink><span class=cF0>().  It is loaded by the boot loader and must fit in 640K.
<a name="l23"></a>
<a name="l24"></a></span><span class=cF2>/Compiler</span><span class=cF0> The compiler module src code is found here.  The compiler is </span><span class=cF2>AOT</span><span class=cF0> 
<a name="l25"></a>compiled to produce a binary file which is loaded at boot.  It, too, is </span><span class=cF2>AOT</span><span class=cF0> 
<a name="l26"></a>compiled by </span><a href="../Adam/Boot/InsBoot.html#l135"></blink><span class=cF4>MakeOSPrtBootInstall</span></a></blink><span class=cF0>().
<a name="l27"></a>
<a name="l28"></a></span><span class=cF2>/Adam</span><span class=cF0> The non-kernel part of the operating system is found here.  It is </span><span class=cF2>JIT</span><span class=cF0> 
<a name="l29"></a>compiled during boot.
<a name="l30"></a>
<a name="l31"></a>
<a name="l32"></a>
<a name="l33"></a></span><span class=cF5>                                   Acct Files</span><span class=cF0>
<a name="l34"></a>
<a name="l35"></a>You can add and remove accts by making or removing directories in the </span><span class=cF2>::/Accts</span><span class=cF0> 
<a name="l36"></a>directory.  An empty account directory should be valid because it will get 
<a name="l37"></a>default files from the parent directory.  Compile the </span><a href="../Adam/Boot/InsBoot.html#l135"></blink><span class=cF4>Kernel</span></a></blink><span class=cF0> to set the active 
<a name="l38"></a>acct or cause it to prompt an account at boot. 
<a name="l39"></a></span><span class=cF4>
<a name="l40"></a></span><a href="http://www.templeos.org/Wb/Accts/TS/TAD/PersonalMenu.html#l1"></blink><span class=cF4>HOME/PersonalMenu.TXT</span></a></blink><span class=cF0> a menu viewed with the </span><span class=cF2>&lt;CTRL-m&gt;</span><span class=cF0> key or by clicking &quot;</span><span class=cF2>MENU</span><span class=cF0>&quot; 
<a name="l41"></a>in the upper left border area of a window.
<a name="l42"></a></span><span class=cF4>
<a name="l43"></a></span><a href="http://www.templeos.org/Wb/Accts/TS/TAD/PersonalNotes.html#l1"></blink><span class=cF4>HOME/PersonalNotes.TXT</span></a></blink><span class=cF0> a personal note file viewed with the </span><span class=cF2>&lt;CTRL-SHIFT-M&gt;</span><span class=cF0> key.
<a name="l44"></a></span><span class=cF4>
<a name="l45"></a></span><a href="http://www.templeos.org/Wb/Accts/TS/TAD/Adam3.html#l1"></blink><span class=cF4>HOME/Adam3.CPP</span></a></blink><span class=cF0> files invoked when the adam task starts-up.  Customize these!
<a name="l46"></a></span><span class=cF4>
<a name="l47"></a></span><a href="http://www.templeos.org/Wb/Accts/TS/TAD/DoOnce.html#l1"></blink><span class=cF4>HOME/DoOnce.CPP</span></a></blink><span class=cF0> a file invoked at the start-up of the first user.  Customize 
<a name="l48"></a>this!
<a name="l49"></a></span><span class=cF4>
<a name="l50"></a></span><a href="http://www.templeos.org/Wb/Accts/TS/TAD/Registry.html#l1"></blink><span class=cF4>HOME/Registry.CPP</span></a></blink><span class=cF0> can be edited by hand or deleted to reset to defaults.  Takes 
<a name="l51"></a>affect next boot.
<a name="l52"></a>
<a name="l53"></a>
<a name="l54"></a>
<a name="l55"></a></span><span class=cF5>                              Application Policies</span><span class=cF0>
<a name="l56"></a>
<a name="l57"></a>* Place applications in their own </span><span class=cF2>/Apps</span><span class=cF0> subdirectory.
<a name="l58"></a>
<a name="l59"></a>* Make a file called </span><span class=cF2>Load.CPP.Z</span><span class=cF0> to load the application.
<a name="l60"></a>
<a name="l61"></a>* Make a file called </span><span class=cF2>Run.CPP.Z</span><span class=cF0> to load and run the application, preferable by </span><span class=cF2>#i
<a name="l62"></a>nclude</span><span class=cF0>ing the </span><span class=cF2>Load.CPP.Z</span><span class=cF0> file.
<a name="l63"></a>
<a name="l64"></a>* Place user data in a subdirectory of </span><span class=cF2>HOME</span><span class=cF0>, preferably naming the subdirectory 
<a name="l65"></a>the same as the </span><span class=cF2>/Apps</span><span class=cF0> subdirectory.  Or, place data in the </span><span class=cF2>Registry.CPP.Z</span><span class=cF0> file.  
<a name="l66"></a>See </span><a href="../Demo/RegistryDemo.html#l1"></blink><span class=cF4>::/Demo/RegistryDemo.CPP</span></a></blink><span class=cF0>.
<a name="l67"></a>
<a name="l68"></a>* If the app needs files in the </span><span class=cF2>HOME</span><span class=cF0> directory, make an </span><span class=cF2>/Apps</span><span class=cF0> file called </span><span class=cF2>Instal
<a name="l69"></a>l.CPP.Z</span><span class=cF0> or </span><span class=cF2>Install.AUT.Z</span><span class=cF0> to create the </span><span class=cF2>HOME</span><span class=cF0> subdirectory and do similar stuff.
<a name="l70"></a>
<a name="l71"></a> 
<a name="l72"></a>
<a name="l73"></a></span><span class=cF5>                             Programming Guidelines</span><span class=cF0>
<a name="l74"></a>
<a name="l75"></a>* Virtual mem/Paging is not used -- it is identity mapped in </span><span class=cF2>x86_64</span><span class=cF0> mode.  The 
<a name="l76"></a>stk does not grow, so allocate enough when the task (process) is </span><a href="../Kernel/Task1a.html#l221"></blink><span class=cF4>Spawn</span></a></blink><span class=cF0>ed and use 
<a name="l77"></a>the heap for most things.  (The </span><span class=cF2>heap</span><span class=cF0> refers to </span><a href="../Kernel/Mem1b.html#l373"></blink><span class=cF4>MAlloc</span></a></blink><span class=cF0>() and </span><a href="../Kernel/Mem1b.html#l369"></blink><span class=cF4>Free</span></a></blink><span class=cF0>().)
<a name="l78"></a>
<a name="l79"></a>* See </span><a href="Glossary.html#l257"></blink><span class=cF4>Naming Convention</span></a></blink><span class=cF0> and </span><a href="Glossary.html#l3"></blink><span class=cF4>Abbreviations</span></a></blink><span class=cF0>.
<a name="l80"></a>
<a name="l81"></a>* There are two modes of compiling, </span><a href="Glossary.html#l174"></blink><span class=cF4>AOT Compile Mode</span></a></blink><span class=cF0> and </span><a href="Glossary.html#l186"></blink><span class=cF4>JIT Compile Mode</span></a></blink><span class=cF0>.  
<a name="l82"></a>Compilation is done in both -- neither is &quot;interpreted&quot;.  Use </span><a href="Glossary.html#l186"></blink><span class=cF4>JIT Mode</span></a></blink><span class=cF0>.
<a name="l83"></a>
<a name="l84"></a>* </span><a href="HolyC.html#l1"></blink><span class=cF4>HolyC</span></a></blink><span class=cF0>
<a name="l85"></a>
<a name="l86"></a>* Use </span><span class=cF2>I64</span><span class=cF0> instead of smaller int sizes because the compiler converts everything 
<a name="l87"></a>to 64-bit.  Don't use unsigned unless it actually breaks.  A policy of signed 
<a name="l88"></a>keeps it simple so you don't have to agonize over choices.
<a name="l89"></a>
<a name="l90"></a>* In-order, short circuit logic is used, in fact required.
<a name="l91"></a>
<a name="l92"></a>* Avoid boolean expression assignments.  Boolean assignments don't have short 
<a name="l93"></a>circuit logic and are not compiled efficiently.  The </span><span class=cF2>Bool</span><span class=cF0> type is just an alias 
<a name="l94"></a>for a 1 byte signed int -- nothing forces it to </span><span class=cF2>1</span><span class=cF0> or </span><span class=cF2>0</span><span class=cF0>.  There is a </span><a href="../Kernel/Adam1b.html#l91"></blink><span class=cF4>ToBool</span></a></blink><span class=cF0>() 
<a name="l95"></a>function that will for to </span><span class=cF2>1</span><span class=cF0> ot </span><span class=cF2>0</span><span class=cF0>, however.
<a name="l96"></a>
<a name="l97"></a>* If you use floats in your interrupt routine, save and restore the fpu state 
<a name="l98"></a>with </span><a href="../Kernel/Adam1b.html#l105"></blink><span class=cF4>Fxsave</span></a></blink><span class=cF0>() and </span><a href="../Kernel/Adam1b.html#l104"></blink><span class=cF4>Fxrstor</span></a></blink><span class=cF0>().  The timer interrupt does this.  The keyboard and 
<a name="l99"></a>mouse don't use floats.
<a name="l100"></a>
<a name="l101"></a>* Bracketing code with </span><span class=cF2>PUSHFD CLI</span><span class=cF0> and </span><span class=cF2>POPFD</span><span class=cF0> will protect against simultaneous 
<a name="l102"></a>accesses from tasks on </span><span class=cF0>one</span><span class=cF0> core.  To protect against multiple cores, you need a 
<a name="l103"></a>locked semaphore.  I think semiphores need to be in their own cache line, but 
<a name="l104"></a>I'm not sure.  I use lock bits in a lot of places not aligned.
<a name="l105"></a>
<a name="l106"></a>* </span><a href="../Kernel/Misc1a.html#l234"></blink><span class=cF4>SysDbg</span></a></blink><span class=cF0>() and </span><a href="../Kernel/Misc1a.html#l239"></blink><span class=cF4>IsSysDbg</span></a></blink><span class=cF0>() are really handy when working on the compiler or 
<a name="l107"></a>kernel.  It's just a bit you can set and test.
<a name="l108"></a>
<a name="l109"></a>* I don't use </span><span class=cF2>U0 *</span><span class=cF0> because the size is zero for ptr arithmetic.
<a name="l110"></a>
<a name="l111"></a>* Use </span><a href="../Kernel/Adam1a.html#l3414"></blink><span class=cF4>CH_SHIFT_SPACE</span></a></blink><span class=cF0> for spaces in quotes in source code because I run </span><span class=cF4>
<a name="l112"></a></span><a href="../Adam/Utils/S2T.html#l48"></blink><span class=cF4>Spaces-to-Tabs</span></a></blink><span class=cF0> on source code.
<a name="l113"></a>
<a name="l114"></a>
<a name="l115"></a>
<a name="l116"></a></span><span class=cF5>                                Hash Sym Tables</span><span class=cF0>
<a name="l117"></a>
<a name="l118"></a>* See </span><a href="../Adam/Hash2a.html#l1"></blink><span class=cF4>::/Adam/Hash2a.CPP</span></a></blink><span class=cF0> for examples of how the hash tables are set-up.  
<a name="l119"></a>Basically, syms are placed into hash tables and child process hash tables are 
<a name="l120"></a>chained to parents.  This provides scopes for vars and functions.
<a name="l121"></a>
<a name="l122"></a>* </span><span class=cF2>adam_task-&gt;hash_table</span><span class=cF0> holds the </span><a href="HolyC.html#l1"></blink><span class=cF4>HolyC</span></a></blink><span class=cF0> syms loaded in on start-up.
<a name="l123"></a>
<a name="l124"></a>* </span><span class=cF2>Fs-&gt;hash_table</span><span class=cF0> holds user HolyC syms and if a sym is not found, it checks 
<a name="l125"></a>parents.  When a duplicate sym is added to the table, it overshadows the 
<a name="l126"></a>previous sym.  When developing software, typically you include the file at the 
<a name="l127"></a>cmd prompt, make changes and reinclude it.  Old syms are overshadowed but they 
<a name="l128"></a>are still there.  Periodically, kill the TASK and start fresh when mem is low.  
<a name="l129"></a>If you wish your applications to free themselves instead of staying in mem, 
<a name="l130"></a>spawn or </span><a href="../Adam/DolDoc/DocPopUp.html#l407"></blink><span class=cF4>PopUp</span></a></blink><span class=cF0>() a task to run the application and kill it when it's done.
<a name="l131"></a>
<a name="l132"></a>* To display the contents of a hash table, use the </span><a href="../Adam/Hash2a.html#l143"></blink><span class=cF4>Who</span></a></blink><span class=cF0>() routine or the 
<a name="l133"></a>varients.  </span><a href="../Adam/Hash2a.html#l369"></blink><span class=cF4>HashDepthRep</span></a></blink><span class=cF0>() gives a histogram  of how long the chains are, in case 
<a name="l134"></a>you wish to make hash table sizes bigger.
<a name="l135"></a>
<a name="l136"></a>
<a name="l137"></a>
<a name="l138"></a></span><span class=cF5>                               Assembly Language</span><span class=cF0>
<a name="l139"></a>
<a name="l140"></a>* </span><span class=cF2>FS</span><span class=cF0> must always point to the cur </span><a href="../Kernel/Adam1a.html#l3214"></blink><span class=cF4>CTask</span></a></blink><span class=cF0>.
<a name="l141"></a>
<a name="l142"></a>* </span><span class=cF2>GS</span><span class=cF0> must always point to the cur </span><a href="../Kernel/Adam1a.html#l3339"></blink><span class=cF4>CCPU</span></a></blink><span class=cF0>.
<a name="l143"></a>
<a name="l144"></a>* Don't change the segment regs unless interrupts are off.  It's hard to do, 
<a name="l145"></a>anyway.  </span><a href="../Kernel/Utils1a.html#l447"></blink><span class=cF4>SET_FS_BASE</span></a></blink><span class=cF0> and </span><a href="../Kernel/Utils1a.html#l435"></blink><span class=cF4>SET_GS_BASE</span></a></blink><span class=cF0>.
<a name="l146"></a>
<a name="l147"></a>* When interacting with </span><a href="HolyC.html#l1"></blink><span class=cF4>HolyC</span></a></blink><span class=cF0> compiled code, preserve </span><span class=cF2>RBP, RSI, RDI, R10-R15</span><span class=cF0> 
<a name="l148"></a>because the compiler uses these for reg vars.  You are free to clobber </span><span class=cF2>RAX, RBX, 
<a name="l149"></a>RCX, RDX</span><span class=cF0>, </span><span class=cF2>R8</span><span class=cF0> and </span><span class=cF2>R9</span><span class=cF0>.  See </span><a href="../Kernel/Adam1a.html#l1696"></blink><span class=cF4>Compiler Reg Masks</span></a></blink><span class=cF0>, </span><a href="../Kernel/Adam1a.html#l1672"></blink><span class=cF4>PUSH_C_REGS</span></a></blink><span class=cF0> and </span><a href="../Kernel/Adam1a.html#l1673"></blink><span class=cF4>POP_C_REGS</span></a></blink><span class=cF0>
<a name="l150"></a>
<a name="l151"></a>* I recommend using the standard stk frame for functions because </span><a href="../Kernel/Dbg1a.html#l59"></blink><span class=cF4>Caller</span></a></blink><span class=cF0>() is 
<a name="l152"></a>used to display the call stk, such as for the wallpaper.
<a name="l153"></a></span><span class=cF2>        PUSH    RBP
<a name="l154"></a>        MOV     RBP,RSP
<a name="l155"></a>        SUB     RSP,nnnn
<a name="l156"></a>...
<a name="l157"></a>        LEAVE
<a name="l158"></a>        RET
<a name="l159"></a></span><span class=cF0>
<a name="l160"></a>* The args are removed from the stack with </span><span class=cF2>RET1</span><span class=cF0> statements.
<a name="l161"></a>
<a name="l162"></a>        </span><span class=cF2>RET1    16      //remove two args</span><span class=cF0>
<a name="l163"></a>
<a name="l164"></a>* No args are passed in regs.
<a name="l165"></a>
<a name="l166"></a>* RAX holds function return values, of course.
</span></pre></body>
</html>
<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://l.yimg.com/d/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1409528694" alt="setstats" border="0" width="1" height="1"></noscript><script type="text/javascript" src="https://s.yimg.com/mi/vs4/ywa.js"></script><script type="text/javascript">try {var YWAGTracker = YWA.getTracker("10001849413879", "VSCALE4");YWAGTracker.setDocumentName("WPAGE");YWAGTracker.setDocumentGroup("YSBW");YWAGTracker.setCF(7, "templeos.org");YWAGTracker.setCF(8, "w42");YWAGTracker.submit();} catch (eYWATCUnavailable) {}</script><script type="text/javascript">(function (d, w) {var x = d.getElementsByTagName('SCRIPT')[0];var f = function () {var s = d.createElement('SCRIPT');s.type = 'text/javascript';s.async = true;s.src = "//np.lexity.com/embed/YW/eff965aab4535cd38b91f0976c617496?id=9382d670eca2";x.parentNode.insertBefore(s, x);};w.attachEvent ? w.attachEvent('onload',f) :w.addEventListener('load',f,false);}(document, window));</script>